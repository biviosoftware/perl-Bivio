# Copyright (c) 2005-2006 bivio Software, Inc.  All rights reserved.
# $Id$
Request();
req()->initialize_fully;
my($resource) = class('Bivio::Agent::t::Mock::Resource')->new;
[
    sub {req()} => [
	{
	    method => 'unsafe_get_txn_resource',
	    compute_params => sub {
		my(undef, $params) = @_;
		req()->push_txn_resource($params->[0])
		    if @$params;
		return [ref($resource)];
	    },
	} => [
	    [] => [undef],
	    [$resource] => [$resource],
	],
	format_uri => [
	    LOGOUT => '/pub/logout',
	    [{task_id => 'LOGOUT'}] => '/pub/logout',
	    [{
		task_id => 'LOGOUT',
		facade_uri => 'other',
	    }] => qr{^http://other.*/pub/logout$},
	    sub {
		shift->get('object')->put(req()->REQUIRE_ABSOLUTE_GLOBAL => 1);
		return ['LOGOUT'];
	    } => sub {
		shift->get('object')->delete(req()->REQUIRE_ABSOLUTE_GLOBAL);
		return qr{^http:/.*/pub/logout$};
	    },
	    LOGOUT => '/pub/logout',
	],
	format_http_prefix => [
	    [] => qr{^http://(?!other)},
	    [1] => qr{^https://(?!other)},
	    [undef, 'other'] => qr{^\Qhttp://other.},
	    [1, 'other'] => qr{^\Qhttps://other.},
	    [undef, 'bad.facade.name'] => qr{^http://(?!other)},
	],
    ],
];

