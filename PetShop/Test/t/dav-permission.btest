# Copyright (c) 2005 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop');
home_page();
my($root) = '/demo/dav/files';
my($x) = absolute_uri("$root/pub2");
test_deviance(qr{authorization}i);
send_request(OPTIONS => "$root");
test_conformance();
basic_authorization('root>guest', 'bad pass');
$root =~ s{/files}{};
test_deviance();
send_request(PROPFIND => $root);
test_conformance();
basic_authorization('root');
test_deviance();
send_request(PROPFIND => $root);
test_conformance();
basic_authorization('root>guest');
send_request(PROPFIND => $root);
basic_authorization('guest');
send_request(PROPFIND => $root);
verify_no_text('orders');
test_deviance(qr{forbidden}i);
send_request(PROPFIND => "$root/orders");
test_conformance();
$root .= '/files';
visit_uri("$root/private/file.html");
send_request(PROPFIND => "$root/private");
my($rand) = random_string();
test_deviance(qr{not.found}i);
send_request(PROPFIND => "$root/pub/dav-permission.$rand");
test_deviance(qr{forbidden}i);
send_request(MKCOL => "$root/pub/dav-permission.$rand");
send_request(PUT => "$root/pub/dav-permission.$rand", undef, '');
send_request(DELETE => "$root/pub/file.txt");
send_request(LOCK => "$root/pub");
send_request(MOVE => "$root/pub", {
    Destination => $x,
});
test_conformance();
send_request(OPTIONS => "$root/private");
visit_uri("$root/private/file.html");
# Don't write to '/' or '/pub', other tests depend
send_request(COPY => "$root/private/file.html", {
    Destination => absolute_uri('/guest/dav/files/dav-permission'),
});
$x = absolute_uri("$root/dav-permission");
test_deviance('forbidden');
send_request(COPY => '/guest/dav/files/private/file.html', {
    Destination => $x,
});
