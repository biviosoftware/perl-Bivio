# Copyright (c) 2008 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop');
home_page();
login_as('root');
my($nfe) = '/dav/site/Files/Public/Wiki/NotFoundError';
unsafe_op(send_request => DELETE => $nfe);
home_page();
do_logout();
home_page();
test_deviance();
visit_uri('/fourem/file/NoFileHere');
test_conformance();
test_equals(404, get_response()->code());
follow_link('go_back.*previous');
follow_link('fish');
test_deviance();
visit_uri('/not-found-uri');
test_conformance();
test_equals(404, get_response()->code());
follow_link('go_back.*previous');
follow_link('angelfish');
my($uri) = get_uri() =~ /^(.+)\?/;
test_deviance();
do_test_backdoor('NoSuchUtil');
test_conformance();
test_equals(500, get_response()->code());
follow_link('go_back.*previous');
follow_link('large_angelfish');
test_self()->put(referer => '');
test_deviance();
visit_uri('/not-found-uri');
test_conformance();
follow_link('home_page');
login_as('demo');
test_self()->put(referer => '');
test_deviance();
visit_uri('/not-found-uri');
test_conformance();
follow_link('personal_page');
login_as('root');
my($key) = 'error.btest page ' . random_string();
send_request(PUT => $nfe, undef, <<"EOF");
\@h1 Page Not Found
$key
EOF
do_logout();
test_deviance('not found');
visit_uri('/fourem/file/NoFileHere');
test_conformance();
test_equals(404, get_response()->code());
verify_text($key);
test_deviance('not found');
visit_uri('/not-found-uri');
test_conformance();
test_equals(404, get_response()->code());
verify_text($key);
my($u) = get_uri();
test_deviance('internal server error');
visit_uri('/pub/products?p=INVALID-PRODUCT');
test_conformance();
verify_no_text('Web Site');
verify_text($u);
verify_text('previous page');

