# Copyright (c) 2006 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop');
my($forum, $uri) = create_forum();
visit_uri("$uri/db-types");
follow_link('add.*type');
submit_form(Save => {
    name => 'i1',
    class => 'Integer',
    default => 1,
    'pick.*_0' => 1,
    'pick.*_1' => 2,
});
follow_link_in_table('Type Name', 'Type Name', 'i1', 'Actions', 'Modify');
submit_form(Save => {
    name => 'i1a',
});
follow_link_in_table('Type Name', 'Type Name', 'i1a', 'Actions', 'Modify');
test_deviance(qr{default value.*pick list}is);
submit_form({
    default => 3,
});
test_deviance(qr{duplicate.*pick list}is);
submit_form({
    default => 1,
    'pick.*_1$' => 1,
});
test_conformance();
follow_link('types');
follow_link('add.*type');
submit_form({
    name => 'i1',
});
follow_link('schemas');
follow_link('add.*schema');
submit_form({
    name => 'Database1',
    prefix => 'd1',
    'field.*_0$' => 'f1',
    'type.*_0$' => 'i1',
    'required.*_0$' => 0,
    'field.*_1$' => 'f2',
    'type.*_1$' => 'Date',
    'required.*_1$' => 1,
});
follow_link('tables');
follow_link('add.*table');
submit_form({
    schema => 'Database1',
});
follow_link_in_table('Table Name', 'Database1');
follow_link('add.*record');
my($range) = [1 .. 5];
foreach my $i (@$range) {
    go_back() if $i > 1;
    submit_form({
	f1 => $i,
	f2 => "12/$i/2001",
	comment => "update #$i",
    });
    sleep(1);
}
sleep(5);
reload_page();
verify_text(qr{@{[join('.*', map("12/0$_/2001", @$range))]}}s);
