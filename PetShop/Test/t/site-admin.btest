# Copyright (c) 2008 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop', 'groupware');
home_page();
login_as('root');
follow_link('All Users', qr{^All$});
find_page_with_text('User, Demo');
follow_link('User, Demo');
home_page();
follow_link('settings');
verify_form({
    last => 'User',
    size => 15,
});
follow_link('exit');
verify_link('All Users');
# clicking  exit on a stale page should put the user at site root
go_back();
follow_link('exit');
home_page();
verify_link('login');
login_as('root');
follow_link('site-admin');
follow_link('All Users', qr{^All$});
find_page_with_text('User, Btest_read');
follow_link('User, Btest_read');
home_page();
follow_link('wiki');
verify_no_text(qr{new page|this page}i);

follow_link('Logout');
follow_link('All Users');
follow_link('Site Hits');
submit_form(Refresh => {
    '_anon' => 'btest_read',
});
verify_text(qr{root.*acting as.*Btest_read.*/site/wiki/StartPage}im);
submit_form(Refresh => {
    '_anon' => '/bp/StartPage',
});
verify_text(qr{root.*acting as.*Btest_read.*/bp/StartPage}im);

