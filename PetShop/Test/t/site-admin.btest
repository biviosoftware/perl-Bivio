# Copyright (c) 2008 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop', 'groupware');
home_page();
login_as('root');
follow_link('All Users', qr{^All$});
find_page_with_text('User, Demo');
follow_link('User, Demo');
home_page();
follow_link('settings');
verify_form({
    last => 'User',
    size => 15,
});
follow_link('exit');
verify_link('All Users');
# clicking  exit on a stale page should put the user at site root
go_back();
follow_link('exit');
home_page();
verify_link('login');
login_as('root');
follow_link('site-admin');
follow_link('All Users', qr{^All$});
find_page_with_text('User, Btest_read');
follow_link('User, Btest_read');
home_page();
follow_link('wiki');
verify_no_text(qr{new page|this page}i);

follow_link('Logout');
follow_link('All Users');
follow_link('Task Log Report');
submit_form(Search => {
    '_anon' => 'btest_read',
});
verify_table('Date/Time', [
    ['URI', 'Last, First Name'],
    ['/site/wiki/StartPage', 'Staff acting as User, Btest_read'],
]);
submit_form(Search => {
    '_anon' => '/bp/StartPage',
});
verify_table('Date/Time', [
    ['Last, First Name', 'URI'],
    ['Staff acting as User, Btest_read', '/bp/StartPage'],
]);
