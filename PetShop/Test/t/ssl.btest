# Copyright (c) 2008-2012 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop');
my($assert_http) = sub {verify_uri(qr{^http:})};
home_page();
$assert_http->();
(my $uri = get_uri()) =~ s/^http/https/;
# If there's no port on the URI, then can do SSL
my($ssl) = $uri =~ m{^http://[^/]+/};
my($assert_https) = sub {$ssl && verify_uri(qr{^https:})};
$assert_http->();
visit_uri('/fourem/wiki/PrivatePage');
$assert_https->();
submit_form({
    email => 'root',
    password => 'password',
});
home_page();
$assert_http->();
visit_uri('/pub/ping');
$assert_http->();
visit_uri('/pub/test-require-secure');
$assert_https->();
home_page('requiresecure');
$assert_https->();
visit_uri('/pub/ping');
$assert_https->();
visit_uri('/pub/test-want-insecure');
$assert_http->();
visit_uri('/pub/test-require-secure');
$assert_https->();
