# Copyright (c) 2008 bivio Software, Inc.  All Rights Reserved.
# $Id$
test_setup('PetShop');
my($f, $uri) = create_forum();
visit_uri("$uri/mail");
follow_link('new');
my($code) = random_string(16, ['a' .. 'z']);
submit_form(Send => {
    topic => $code,
    text => 'hello goodbye telephone',
});
poll_page(verify_text => $code);
visit_uri("$uri/file");
follow_link_in_table("Name", "Name", "/", "Name", "change");
fixup_files_uri('ADD_SUBFOLDER');
submit_form(OK => {'Name:' => "Wiki"});
follow_link_in_table("Name", "Name", "Wiki", "Name", "change");
fixup_files_uri('TEXT_FILE');
my($unique) = random_string();
submit_form(OK => {
    'Name:' => "cool_$code",
    _anon => "This is some really cool $code. Uniquifier $unique",
    comments => "nc",
});

submit_form({
    _anon => $code,
});
verify_form({
    _anon => $code,
});
verify_text(qr{>$code.*hello goodbye telephone}s);
verify_text(qr{>cool $code<.*>This is some really cool $code}s);
verify_text("$f/wiki");
follow_link(qr{^$code});
verify_link('new_topic');
go_back(2);
follow_link(qr{^cool $code});
verify_text(qr{edit this page}i);
